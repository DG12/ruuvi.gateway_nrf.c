
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>app_uart.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/**</a>
<a name="ln2"> * @addtogroup APP_UART</a>
<a name="ln3"> * @{</a>
<a name="ln4"> */</a>
<a name="ln5">/**</a>
<a name="ln6"> *  @file app_uart.c</a>
<a name="ln7"> *  @author Otso Jousimaa &lt;otso@ojousima.net&gt;</a>
<a name="ln8"> *  @date 2020-05-29</a>
<a name="ln9"> *  @copyright Ruuvi Innovations Ltd, license BSD-3-Clause.</a>
<a name="ln10"> *</a>
<a name="ln11"> *  Application UART control, processing incoming data and sending data out.</a>
<a name="ln12"> */</a>
<a name="ln13">#include &quot;app_config.h&quot;</a>
<a name="ln14">#include &quot;app_uart.h&quot;</a>
<a name="ln15">#include &quot;app_ble.h&quot;</a>
<a name="ln16">#include &quot;ruuvi_boards.h&quot;</a>
<a name="ln17">#include &quot;ruuvi_driver_error.h&quot;</a>
<a name="ln18">#include &quot;ruuvi_endpoint_ca_uart.h&quot;</a>
<a name="ln19">#include &quot;ruuvi_interface_communication.h&quot;</a>
<a name="ln20">#include &quot;ruuvi_interface_communication_ble_advertising.h&quot;</a>
<a name="ln21">#include &quot;ruuvi_interface_watchdog.h&quot;</a>
<a name="ln22">#include &quot;ruuvi_interface_scheduler.h&quot;</a>
<a name="ln23">#include &quot;ruuvi_interface_communication_uart.h&quot;</a>
<a name="ln24">#include &quot;ruuvi_library_ringbuffer.h&quot;</a>
<a name="ln25"> </a>
<a name="ln26">#include &lt;string.h&gt;</a>
<a name="ln27">#include &lt;stdio.h&gt;</a>
<a name="ln28"> </a>
<a name="ln29">#define APP_UART_RING_BUFFER_MAX_LEN     (128U) //!&lt; Ring buffer len       </a>
<a name="ln30">#define APP_UART_RING_DEQ_BUFFER_MAX_LEN (APP_UART_RING_BUFFER_MAX_LEN &gt;&gt;1) //!&lt; Decode buffer len</a>
<a name="ln31"> </a>
<a name="ln32">#ifndef CEEDLING</a>
<a name="ln33">static bool app_uart_ringbuffer_lock_dummy (volatile uint32_t * const flag, bool lock);</a>
<a name="ln34">#endif</a>
<a name="ln35"> </a>
<a name="ln36">static ri_comm_channel_t m_uart; //!&lt; UART communication interface.</a>
<a name="ln37">static uint8_t buffer_data[APP_UART_RING_BUFFER_MAX_LEN] = {0};</a>
<a name="ln38">static bool buffer_wlock = false;</a>
<a name="ln39">static bool buffer_rlock = false;</a>
<a name="ln40">static rl_ringbuffer_t m_uart_ring_buffer =</a>
<a name="ln41">{</a>
<a name="ln42">    .head = 0,</a>
<a name="ln43">    .tail = 0,</a>
<a name="ln44">    .block_size = sizeof (uint8_t),</a>
<a name="ln45">    .storage_size = sizeof (buffer_data),</a>
<a name="ln46">    .index_mask = (sizeof (buffer_data) / sizeof (uint8_t)) - 1,</a>
<a name="ln47">    .storage = buffer_data,</a>
<a name="ln48">    .lock = app_uart_ringbuffer_lock_dummy,</a>
<a name="ln49">    .writelock = &amp;buffer_wlock,</a>
<a name="ln50">    .readlock  = &amp;buffer_rlock</a>
<a name="ln51">};</a>
<a name="ln52"> </a>
<a name="ln53">/** Dummy function to lock/unlock buffer */</a>
<a name="ln54">#ifndef CEEDLING</a>
<a name="ln55">static</a>
<a name="ln56">#endif</a>
<a name="ln57">bool app_uart_ringbuffer_lock_dummy (volatile uint32_t * const flag, bool lock)</a>
<a name="ln58">{</a>
<a name="ln59">    bool * p_bool = (bool *) flag;</a>
<a name="ln60"> </a>
<a name="ln61">    if (*p_bool == lock) { return false; }</a>
<a name="ln62"> </a>
<a name="ln63">    *p_bool = lock;</a>
<a name="ln64">    return true;</a>
<a name="ln65">}</a>
<a name="ln66"> </a>
<a name="ln67">#ifndef CEEDLING</a>
<a name="ln68">static</a>
<a name="ln69">rd_status_t app_uart_apply_config (re_ca_uart_payload_t * p_uart_payload)</a>
<a name="ln70">#else</a>
<a name="ln71">rd_status_t app_uart_apply_config (void * v_uart_payload)</a>
<a name="ln72">#endif</a>
<a name="ln73">{</a>
<a name="ln74">#ifdef CEEDLING</a>
<a name="ln75">    re_ca_uart_payload_t * p_uart_payload = (re_ca_uart_payload_t *) v_uart_payload;</a>
<a name="ln76">#endif</a>
<a name="ln77">    rd_status_t err_code = RD_SUCCESS;</a>
<a name="ln78">    ri_radio_modulation_t modulation;</a>
<a name="ln79">    ri_radio_channels_t channels;</a>
<a name="ln80"> </a>
<a name="ln81">    switch (p_uart_payload-&gt;cmd)</a>
<a name="ln82">    {</a>
<a name="ln83">        case RE_CA_UART_SET_FLTR_TAGS:</a>
<a name="ln84">            err_code |= app_ble_manufacturer_filter_set ( (bool)</a>
<a name="ln85">                        p_uart_payload-&gt;params.bool_param.state);</a>
<a name="ln86">            break;</a>
<a name="ln87"> </a>
<a name="ln88">        case RE_CA_UART_SET_FLTR_ID:</a>
<a name="ln89">            err_code |= app_ble_manufacturer_id_set (p_uart_payload-&gt;params.fltr_id_param.id);</a>
<a name="ln90">            break;</a>
<a name="ln91"> </a>
<a name="ln92">        case RE_CA_UART_SET_CODED_PHY:</a>
<a name="ln93">            modulation = RI_RADIO_BLE_125KBPS;</a>
<a name="ln94">            err_code |= app_ble_modulation_enable (modulation,</a>
<a name="ln95">                                                   (bool) p_uart_payload-&gt;params.bool_param.state);</a>
<a name="ln96">            break;</a>
<a name="ln97"> </a>
<a name="ln98">        case RE_CA_UART_SET_SCAN_1MB_PHY:</a>
<a name="ln99">            modulation = RI_RADIO_BLE_1MBPS;</a>
<a name="ln100">            err_code |= app_ble_modulation_enable (modulation,</a>
<a name="ln101">                                                   (bool) p_uart_payload-&gt;params.bool_param.state);</a>
<a name="ln102">            break;</a>
<a name="ln103"> </a>
<a name="ln104">        case RE_CA_UART_SET_EXT_PAYLOAD:</a>
<a name="ln105">            modulation = RI_RADIO_BLE_2MBPS;</a>
<a name="ln106">            err_code |= app_ble_modulation_enable (modulation,</a>
<a name="ln107">                                                   (bool) p_uart_payload-&gt;params.bool_param.state);</a>
<a name="ln108">            break;</a>
<a name="ln109"> </a>
<a name="ln110">        case RE_CA_UART_SET_CH_37:</a>
<a name="ln111">            err_code |= app_ble_channels_get (&amp;channels);</a>
<a name="ln112">            channels.channel_37 = p_uart_payload-&gt;params.bool_param.state;</a>
<a name="ln113">            err_code |= app_ble_channels_set (channels);</a>
<a name="ln114">            break;</a>
<a name="ln115"> </a>
<a name="ln116">        case RE_CA_UART_SET_CH_38:</a>
<a name="ln117">            err_code |= app_ble_channels_get (&amp;channels);</a>
<a name="ln118">            channels.channel_38 = p_uart_payload-&gt;params.bool_param.state;</a>
<a name="ln119">            err_code |= app_ble_channels_set (channels);</a>
<a name="ln120">            break;</a>
<a name="ln121"> </a>
<a name="ln122">        case RE_CA_UART_SET_CH_39:</a>
<a name="ln123">            err_code |= app_ble_channels_get (&amp;channels);</a>
<a name="ln124">            channels.channel_39 = p_uart_payload-&gt;params.bool_param.state;</a>
<a name="ln125">            err_code |= app_ble_channels_set (channels);</a>
<a name="ln126">            break;</a>
<a name="ln127"> </a>
<a name="ln128">        case RE_CA_UART_SET_ALL:</a>
<a name="ln129">            err_code |= app_ble_manufacturer_id_set (p_uart_payload-&gt;params.all_params.fltr_id.id);</a>
<a name="ln130">            err_code |= app_ble_manufacturer_filter_set ( (bool)</a>
<a name="ln131">                        p_uart_payload-&gt;params.all_params.bools.fltr_tags.state);</a>
<a name="ln132">            channels.channel_37 = p_uart_payload-&gt;params.all_params.bools.ch_37.state;</a>
<a name="ln133">            channels.channel_38 = p_uart_payload-&gt;params.all_params.bools.ch_38.state;</a>
<a name="ln134">            channels.channel_39 = p_uart_payload-&gt;params.all_params.bools.ch_39.state;</a>
<a name="ln135">            err_code |= app_ble_channels_set (channels);</a>
<a name="ln136">            modulation = RI_RADIO_BLE_125KBPS;</a>
<a name="ln137">            err_code |= app_ble_modulation_enable (modulation,</a>
<a name="ln138">                                                   (bool) p_uart_payload-&gt;params.all_params.bools.coded_phy.state);</a>
<a name="ln139">            modulation = RI_RADIO_BLE_1MBPS;</a>
<a name="ln140">            err_code |= app_ble_modulation_enable (modulation,</a>
<a name="ln141">                                                   (bool) p_uart_payload-&gt;params.all_params.bools.scan_phy.state);</a>
<a name="ln142">            modulation = RI_RADIO_BLE_2MBPS;</a>
<a name="ln143">            err_code |= app_ble_modulation_enable (modulation,</a>
<a name="ln144">                                                   (bool) p_uart_payload-&gt;params.all_params.bools.ext_payload.state);</a>
<a name="ln145">            break;</a>
<a name="ln146"> </a>
<a name="ln147">        default:</a>
<a name="ln148">            err_code |= RE_ERROR_INVALID_PARAM;</a>
<a name="ln149">            break;</a>
<a name="ln150">    }</a>
<a name="ln151"> </a>
<a name="ln152">    return err_code;</a>
<a name="ln153">}</a>
<a name="ln154"> </a>
<a name="ln155">#ifndef CEEDLING</a>
<a name="ln156">static</a>
<a name="ln157">#endif</a>
<a name="ln158">void app_uart_parser (void * p_data, uint16_t data_len)</a>
<a name="ln159">{</a>
<a name="ln160">    rd_status_t err_code = RD_SUCCESS;</a>
<a name="ln161">    ri_comm_message_t msg = {0};</a>
<a name="ln162">    re_ca_uart_payload_t uart_payload = {0};</a>
<a name="ln163">    uint8_t dequeue_data[APP_UART_RING_DEQ_BUFFER_MAX_LEN] = {0};</a>
<a name="ln164">    rl_status_t status;</a>
<a name="ln165">    size_t index = 0;</a>
<a name="ln166">    err_code = re_ca_uart_decode ( (uint8_t *) p_data, &amp;uart_payload);</a>
<a name="ln167"> </a>
<a name="ln168">    if (RD_SUCCESS == err_code)</a>
<a name="ln169">    {</a>
<a name="ln170">        if (false == rl_ringbuffer_empty (&amp;m_uart_ring_buffer))</a>
<a name="ln171">        {</a>
<a name="ln172">            do</a>
<a name="ln173">            {</a>
<a name="ln174">                uint8_t * p_dequeue_data;</a>
<a name="ln175">                status = rl_ringbuffer_dequeue (&amp;m_uart_ring_buffer,</a>
<a name="ln176">                                                &amp;p_dequeue_data);</a>
<a name="ln177">                dequeue_data[index++] = *p_dequeue_data;</a>
<a name="ln178">            } while (RL_SUCCESS == status);</a>
<a name="ln179">        }</a>
<a name="ln180">    }</a>
<a name="ln181">    else</a>
<a name="ln182">    {</a>
<a name="ln183">        do</a>
<a name="ln184">        {</a>
<a name="ln185">            status = rl_ringbuffer_queue (&amp;m_uart_ring_buffer,</a>
<a name="ln186">                                          (void *) ( (uint8_t *) p_data + index),</a>
<a name="ln187">                                          sizeof (uint8_t));</a>
<a name="ln188">            index++;</a>
<a name="ln189">        } while ( (RL_SUCCESS == status) &amp;&amp; (index &lt; data_len));</a>
<a name="ln190"> </a>
<a name="ln191">        index = 0;</a>
<a name="ln192"> </a>
<a name="ln193">        do</a>
<a name="ln194">        {</a>
<a name="ln195">            uint8_t * p_dequeue_data;</a>
<a name="ln196">            status = rl_ringbuffer_dequeue (&amp;m_uart_ring_buffer,</a>
<a name="ln197">                                            &amp;p_dequeue_data);</a>
<a name="ln198">            dequeue_data[index++] = *p_dequeue_data;</a>
<a name="ln199">        } while (RL_SUCCESS == status);</a>
<a name="ln200"> </a>
<a name="ln201">        err_code = re_ca_uart_decode ( (uint8_t *) dequeue_data, &amp;uart_payload);</a>
<a name="ln202"> </a>
<a name="ln203">        if (RD_SUCCESS != err_code)</a>
<a name="ln204">        {</a>
<a name="ln205">            size_t len = index - 1;</a>
<a name="ln206">            index = 0;</a>
<a name="ln207"> </a>
<a name="ln208">            do</a>
<a name="ln209">            {</a>
<a name="ln210">                status = rl_ringbuffer_queue (&amp;m_uart_ring_buffer, (void *) (dequeue_data + index),</a>
<a name="ln211">                                              sizeof (uint8_t));</a>
<a name="ln212">                index++;</a>
<a name="ln213">            } while ( (RL_SUCCESS == status) &amp;&amp; (index &lt; len));</a>
<a name="ln214">        }</a>
<a name="ln215">    }</a>
<a name="ln216"> </a>
<a name="ln217">    if (RD_SUCCESS == err_code)</a>
<a name="ln218">    {</a>
<a name="ln219">        if (RD_SUCCESS == app_uart_apply_config (&amp;uart_payload))</a>
<a name="ln220">        {</a>
<a name="ln221">            uart_payload.params.ack.ack_state.state = RE_CA_ACK_OK;</a>
<a name="ln222">        }</a>
<a name="ln223">        else</a>
<a name="ln224">        {</a>
<a name="ln225">            uart_payload.params.ack.ack_state.state = RE_CA_ACK_ERROR;</a>
<a name="ln226">        }</a>
<a name="ln227"> </a>
<a name="ln228">        uart_payload.params.ack.cmd = uart_payload.cmd;</a>
<a name="ln229">        uart_payload.cmd = RE_CA_UART_ACK;</a>
<a name="ln230">        msg.data_length = sizeof (msg);</a>
<a name="ln231">        err_code = re_ca_uart_encode (msg.data, &amp;msg.data_length, &amp;uart_payload);</a>
<a name="ln232">        msg.repeat_count = 1;</a>
<a name="ln233"> </a>
<a name="ln234">        if (RE_SUCCESS == err_code)</a>
<a name="ln235">        {</a>
<a name="ln236">            err_code |= m_uart.send (&amp;msg);</a>
<a name="ln237">        }</a>
<a name="ln238">        else</a>
<a name="ln239">        {</a>
<a name="ln240">            err_code |= RD_ERROR_INVALID_DATA;</a>
<a name="ln241">        }</a>
<a name="ln242">    }</a>
<a name="ln243"> </a>
<a name="ln244">    if (RD_SUCCESS == err_code)</a>
<a name="ln245">    {</a>
<a name="ln246">        ri_watchdog_feed();</a>
<a name="ln247">    }</a>
<a name="ln248">}</a>
<a name="ln249"> </a>
<a name="ln250">#ifndef CEEDLING</a>
<a name="ln251">static</a>
<a name="ln252">#endif</a>
<a name="ln253">rd_status_t app_uart_isr (ri_comm_evt_t evt,</a>
<a name="ln254">                          void * p_data, size_t data_len)</a>
<a name="ln255">{</a>
<a name="ln256">    rd_status_t err_code = RD_SUCCESS;</a>
<a name="ln257"> </a>
<a name="ln258">    switch (evt)</a>
<a name="ln259">    {</a>
<a name="ln260">        case RI_COMM_SENT:</a>
<a name="ln261">            break;</a>
<a name="ln262"> </a>
<a name="ln263">        case RI_COMM_RECEIVED:</a>
<a name="ln264">            err_code |= ri_scheduler_event_put (p_data, (uint16_t) data_len, app_uart_parser);</a>
<a name="ln265">            break;</a>
<a name="ln266"> </a>
<a name="ln267">        default:</a>
<a name="ln268">            break;</a>
<a name="ln269">    }</a>
<a name="ln270"> </a>
<a name="ln271">    RD_ERROR_CHECK (err_code, ~RD_ERROR_FATAL);</a>
<a name="ln272">    return err_code;</a>
<a name="ln273">}</a>
<a name="ln274"> </a>
<a name="ln275">/** @brief convert baudrate from board definition for driver. */</a>
<a name="ln276">static ri_uart_baudrate_t rb_to_ri_baud (const uint32_t rb_baud)</a>
<a name="ln277">{</a>
<a name="ln278">    ri_uart_baudrate_t baud;</a>
<a name="ln279"> </a>
<a name="ln280">    switch (rb_baud)</a>
<a name="ln281">    {</a>
<a name="ln282">        case RB_UART_BAUDRATE_9600:</a>
<a name="ln283">            baud = RI_UART_BAUD_9600;</a>
<a name="ln284">            break;</a>
<a name="ln285"> </a>
<a name="ln286">        case RB_UART_BAUDRATE_115200:</a>
<a name="ln287">            baud = RI_UART_BAUD_115200;</a>
<a name="ln288">            break;</a>
<a name="ln289"> </a>
<a name="ln290">        default:</a>
<a name="ln291">            baud = RI_UART_BAUD_115200;</a>
<a name="ln292">            break;</a>
<a name="ln293">    }</a>
<a name="ln294"> </a>
<a name="ln295">    return baud;</a>
<a name="ln296">}</a>
<a name="ln297"> </a>
<a name="ln298">static void setup_uart_init (ri_uart_init_t * const p_init)</a>
<a name="ln299">{</a>
<a name="ln300">    // Ruuvi board pin definitions are compatible with</a>
<a name="ln301">    // Ruuvi driver pin definitions.</a>
<a name="ln302">#if APP_USBUART_ENABLED</a>
<a name="ln303">    p_init-&gt;hwfc_enabled = RB_UART_USB_HWFC_ENABLED;</a>
<a name="ln304">    p_init-&gt;parity_enabled = RB_UART_USB_PARITY_ENABLED;</a>
<a name="ln305">    p_init-&gt;cts = RB_UART_USB_CTS_PIN;</a>
<a name="ln306">    p_init-&gt;rts = RB_UART_USB_RTS_PIN;</a>
<a name="ln307">    p_init-&gt;tx = RB_UART_USB_TX_PIN;</a>
<a name="ln308">    p_init-&gt;rx = RB_UART_USB_RX_PIN;</a>
<a name="ln309">    p_init-&gt;baud = rb_to_ri_baud (RB_UART_BAUDRATE);</a>
<a name="ln310">#else</a>
<a name="ln311">    p_init-&gt;hwfc_enabled = RB_HWFC_ENABLED;</a>
<a name="ln312">    p_init-&gt;parity_enabled = RB_PARITY_ENABLED;</a>
<a name="ln313">    p_init-&gt;cts  = RB_UART_CTS_PIN;</a>
<a name="ln314">    p_init-&gt;rts  = RB_UART_RTS_PIN;</a>
<a name="ln315">    p_init-&gt;tx   = RB_UART_TX_PIN;</a>
<a name="ln316">    p_init-&gt;rx   = RB_UART_RX_PIN;</a>
<a name="ln317">    p_init-&gt;baud = rb_to_ri_baud (RB_UART_BAUDRATE);</a>
<a name="ln318">#endif</a>
<a name="ln319">}</a>
<a name="ln320"> </a>
<a name="ln321">rd_status_t app_uart_init (void)</a>
<a name="ln322">{</a>
<a name="ln323">    rd_status_t err_code = RD_SUCCESS;</a>
<a name="ln324">    ri_uart_init_t config = { 0 };</a>
<a name="ln325">    setup_uart_init (&amp;config);</a>
<a name="ln326">    err_code |= ri_uart_init (&amp;m_uart);</a>
<a name="ln327"> </a>
<a name="ln328">    if (RD_SUCCESS == err_code)</a>
<a name="ln329">    {</a>
<a name="ln330">        m_uart.on_evt = app_uart_isr;</a>
<a name="ln331">        err_code |= ri_uart_config (&amp;config);</a>
<a name="ln332">    }</a>
<a name="ln333"> </a>
<a name="ln334">    return err_code;</a>
<a name="ln335">}</a>
<a name="ln336"> </a>
<a name="ln337">rd_status_t app_uart_send_broadcast (const ri_adv_scan_t * const scan)</a>
<a name="ln338">{</a>
<a name="ln339">    re_ca_uart_payload_t adv = {0};</a>
<a name="ln340">    ri_comm_message_t msg = {0};</a>
<a name="ln341">    rd_status_t err_code = RD_SUCCESS;</a>
<a name="ln342">    re_status_t re_code = RE_SUCCESS;</a>
<a name="ln343"> </a>
<a name="ln344">    if (NULL == scan)</a>
<a name="ln345">    {</a>
<a name="ln346">        err_code |= RD_ERROR_NULL;</a>
<a name="ln347">    }</a>
<a name="ln348">    else if (RE_CA_UART_ADV_BYTES &gt;= scan-&gt;data_len)</a>
<a name="ln349">    {</a>
<a name="ln350">        memcpy (adv.params.adv.mac, scan-&gt;addr, sizeof (adv.params.adv.mac));</a>
<a name="ln351">        memcpy (adv.params.adv.adv, scan-&gt;data, scan-&gt;data_len);</a>
<a name="ln352">        adv.params.adv.rssi_db = scan-&gt;rssi;</a>
<a name="ln353">        adv.params.adv.adv_len = scan-&gt;data_len;</a>
<a name="ln354">        adv.cmd = RE_CA_UART_ADV_RPRT;</a>
<a name="ln355">        msg.data_length = sizeof (msg);</a>
<a name="ln356">        re_code = re_ca_uart_encode (msg.data, &amp;msg.data_length, &amp;adv);</a>
<a name="ln357">        msg.repeat_count = 1;</a>
<a name="ln358"> </a>
<a name="ln359">        if (RE_SUCCESS == re_code)</a>
<a name="ln360">        {</a>
<a name="ln361">            err_code |= m_uart.send (&amp;msg);</a>
<a name="ln362">        }</a>
<a name="ln363">        else</a>
<a name="ln364">        {</a>
<a name="ln365">            err_code |= RD_ERROR_INVALID_DATA;</a>
<a name="ln366">        }</a>
<a name="ln367">    }</a>
<a name="ln368">    else</a>
<a name="ln369">    {</a>
<a name="ln370">        err_code |= RD_ERROR_DATA_SIZE;</a>
<a name="ln371">    }</a>
<a name="ln372"> </a>
<a name="ln373">    return err_code;</a>
<a name="ln374">}</a>
<a name="ln375"> </a>
<a name="ln376">/** @} */</a>

</code></pre>
<div class="balloon" rel="46"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '-' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="59"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2545/" target="_blank">V2545</a> Conversion between pointers to the 'unsigned int' type and the '_Bool' type should not be performed. Consider inspecting the expression: '(_Bool *) flag'.</p></div>
<div class="balloon" rel="59"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2567/" target="_blank">V2567</a> The cast should not remove 'volatile' qualification from the type that is pointed to by a pointer.</p></div>
<div class="balloon" rel="55"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2506/" target="_blank">V2506</a> A function should have a single point of exit at the end.</p></div>
<div class="balloon" rel="84"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2531/" target="_blank">V2531</a> The 'p_uart_payload->params.bool_param.state' expression of the essential 'unsigned' type should not be cast to the essential 'Boolean' type.</p></div>
<div class="balloon" rel="95"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2531/" target="_blank">V2531</a> The 'p_uart_payload->params.bool_param.state' expression of the essential 'unsigned' type should not be cast to the essential 'Boolean' type.</p></div>
<div class="balloon" rel="95"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> Value of the expression should not be converted from the essential 'Boolean' type to the essential 'ri_radio_modulation_t' type.</p></div>
<div class="balloon" rel="101"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2531/" target="_blank">V2531</a> The 'p_uart_payload->params.bool_param.state' expression of the essential 'unsigned' type should not be cast to the essential 'Boolean' type.</p></div>
<div class="balloon" rel="101"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> Value of the expression should not be converted from the essential 'Boolean' type to the essential 'ri_radio_modulation_t' type.</p></div>
<div class="balloon" rel="107"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2531/" target="_blank">V2531</a> The 'p_uart_payload->params.bool_param.state' expression of the essential 'unsigned' type should not be cast to the essential 'Boolean' type.</p></div>
<div class="balloon" rel="107"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> Value of the expression should not be converted from the essential 'Boolean' type to the essential 'ri_radio_modulation_t' type.</p></div>
<div class="balloon" rel="130"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2531/" target="_blank">V2531</a> Expression of the essential 'unsigned' type should not be cast to the essential 'Boolean' type.</p></div>
<div class="balloon" rel="138"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2531/" target="_blank">V2531</a> Expression of the essential 'unsigned' type should not be cast to the essential 'Boolean' type.</p></div>
<div class="balloon" rel="138"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> Value of the expression should not be converted from the essential 'Boolean' type to the essential 'ri_radio_modulation_t' type.</p></div>
<div class="balloon" rel="141"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2531/" target="_blank">V2531</a> Expression of the essential 'unsigned' type should not be cast to the essential 'Boolean' type.</p></div>
<div class="balloon" rel="141"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> Value of the expression should not be converted from the essential 'Boolean' type to the essential 'ri_radio_modulation_t' type.</p></div>
<div class="balloon" rel="144"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2531/" target="_blank">V2531</a> Expression of the essential 'unsigned' type should not be cast to the essential 'Boolean' type.</p></div>
<div class="balloon" rel="144"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> Value of the expression should not be converted from the essential 'Boolean' type to the essential 'ri_radio_modulation_t' type.</p></div>
<div class="balloon" rel="166"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2571/" target="_blank">V2571</a> Pointer to void should not be converted to a pointer to object. Consider inspecting the expression: '(uint8_t *) p_data'.</p></div>
<div class="balloon" rel="170"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '==' operator should have the same essential type. The current types are: 'signed' and 'Boolean'.</p></div>
<div class="balloon" rel="176"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v614/" target="_blank">V614</a> Uninitialized pointer 'p_dequeue_data' used. Consider checking the second actual argument of the 'rl_ringbuffer_dequeue' function.</p></div>
<div class="balloon" rel="176"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2538/" target="_blank">V2538</a> The value of uninitialized variable 'p_dequeue_data' should not be used. Consider checking the second actual argument of the 'rl_ringbuffer_dequeue' function.</p></div>
<div class="balloon" rel="186"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2571/" target="_blank">V2571</a> Pointer to void should not be converted to a pointer to object. Consider inspecting the expression: '(uint8_t *) p_data'.</p></div>
<div class="balloon" rel="186"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2562/" target="_blank">V2562</a> Expressions with pointer type should not be used in the '+', '-', '+=' and '-=' operations.</p></div>
<div class="balloon" rel="191"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="197"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v614/" target="_blank">V614</a> Uninitialized pointer 'p_dequeue_data' used. Consider checking the second actual argument of the 'rl_ringbuffer_dequeue' function.</p></div>
<div class="balloon" rel="197"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2538/" target="_blank">V2538</a> The value of uninitialized variable 'p_dequeue_data' should not be used. Consider checking the second actual argument of the 'rl_ringbuffer_dequeue' function.</p></div>
<div class="balloon" rel="205"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '-' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="206"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="210"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2562/" target="_blank">V2562</a> Expressions with pointer type should not be used in the '+', '-', '+=' and '-=' operations.</p></div>
<div class="balloon" rel="221"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="225"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="230"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the 'sizeof (msg)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="232"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="267"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2519/" target="_blank">V2519</a> The 'default' label should, besides a 'break' statement, contain either a statement or a comment.</p></div>
<div class="balloon" rel="254"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2009/" target="_blank">V2009</a> Consider rendering the 'p_data' pointer as a pointer to const.</p></div>
<div class="balloon" rel="311"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'Boolean' and 'signed'.</p></div>
<div class="balloon" rel="312"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'Boolean' and 'signed'.</p></div>
<div class="balloon" rel="313"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0xFFFFU)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="314"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0xFFFFU)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="315"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(((0U) << 8U) + (31U))' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="316"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(((0U) << 8U) + (12U))' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="353"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the 'scan->data_len' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="355"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the 'sizeof (msg)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="357"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
